# MicroProto UP - Version 1.0

## Scope

This document describes version 1.0 of MicroProto, a lightweighted protocol over TCP.

## Copyright

Copyright (c) 2022 LÃ©opold Houdin. All Rights Reserved.

## Abstract

The MicroProtocol (UP, U as the greek micro character) is an application-level protocol 
for distributed information systems. It is a generic, stateless protocol which can be  
used for simple data exchange between applications. It is strongly inspired by the 
HyperText Transfer Protocol (HTTP).

## Table of Contents

- [1 Introduction](#1-introduction)
  - [1.1 Purpose](#1.1-purpose)
  - [1.2 Terminology](#1.2-terminology)
  - [1.3 Overall Operation](#1.3-overall-operation)
- [2 Notational Conventions and Generic Grammar](#2-notational-conventions-and-generic-grammar)
  - [2.1 Augmented BNF](#2.1-augmented-bnf)
  - [2.2 Basic Rules](#2.2-basic-rules)
- [3 Protocol parameters](#3-protocol-parameters)
  - [3.1 UP Version](#3.1-up-version)
  - [3.2 Resource References](#3.2-resource-references)
  - [3.3 Date/Time Formats](#3.3-date-time-formats)
  - [3.4 Media Types](#3.4-media-types)
- [4 UP Message](#4-up-message)
- [5 Request](#5-request)
- [6 Response](#6-reponse)

## 1 Introduction

### 1.1 Purpose

The MicroProtocol (UP, U as the greek micro character) is an application-level protocol
for distributed information systems. It is a generic, stateless protocol which can be
used for simple data exchange between applications. It is strongly inspired by the
Hypertext Transfer Protocol (HTTP), but has many features removed to keep it as simple
as possible.

UP allows data exchange in a generic way between two applicative agents without 
extensive prior knowledge on the kind of data.

### 1.2 Terminology

This specification uses a number of terms to refer to the roles played by participants 
in, and objects of, the UP communication:

- connection: _A transport layer virtual circuit established between two application 
  programs for the purpose of communication._

- message: _The basic unit of UP communication, consisting of a structured sequence of
  octets matching the syntax defined in Section 4 and transmitted via the connection._

- request: _An UP request message (as defined in Section 5)._

- response: _An UP response message (as defined in Section 6)._

- resource: _A network data object or service which can be identified by a RRef (Section
  3.2)._

- client: _An application program that establishes connections for the purpose of 
  sending requests._

- server: _An application program that accepts connections in order to service requests 
  by sending back responses._

### 1.3 Overall Operation

The UP protocol is based on a request/response paradigm. A client establishes a
connection with a server and sends a request to the server in the form of a request
method, RRef, and protocol version, followed by a MIME-like message containing request 
modifiers, client information, and possible body content. The server responds with a
status line, including the message's protocol version and a success or error code,
followed by a MIME-like message containing server information, entity metainformation,
and possible body content.

Any UP communication is initiated by a client and consists of a request to be applied to
a resource on some server. This is be accomplished via a single connection (v) between
the client (C) and the server (S).

         request chain ------------------------>
       C -------------------v------------------- S
         <----------------------- response chain

## 2 Notational Conventions and Generic Grammar

### 2.1 Augmented BNF

All of the mechanisms specified in this document are described in both prose and an
augmented Backus-Naur Form (BNF) similar to that used by RFC 822. Implementors will need
to be familiar with the notation in order to understand this specification. The 
augmented BNF includes the following constructs:

    name = definition

The name of a rule is simply the name itself (without any enclosing `<` and `>`) and is 
separated from its definition by the equal character "=". Whitespace is only significant 
in that indentation of continuation lines is used to indicate a rule definition that
spans more than one line. Certain basic rules are in uppercase, such as `SP`, `LWS`,
`CRLF`, `DIGIT`, `ALPHA`, etc. Angle brackets are used within definitions whenever their
presence will facilitate discerning the use of rule names.

    "literal"

Quotation marks surround literal text. Unless stated otherwise, the text is
case-insensitive.

    rule1 | rule2

Elements separated by a bar (`|`) are alternatives, e.g., `yes | no` will accept `yes`
or `no`.

    (rule1 rule2)

Elements enclosed in parentheses are treated as a single element. Thus, 
`(elem (foo | bar) elem)` allows the token sequences `elem foo elem` and 
`elem bar elem`.

    *rule

The character `*` preceding an element indicates repetition. The full form is
`<n>*<m>element` indicating at least `<n>` and at most `<m>` occurrences of element.
Default values are 0 and infinity so that `*(element)` allows any number, including 
zero; `1*element` requires at least one; and `1*2element` allows one or two.

    [rule]

Square brackets enclose optional elements; `[foo bar]` is equivalent to `*1(foo bar)`.

### 2.2 Basic Rules

The following rules are used throughout this specification to describe basic parsing
constructs.

    OCTET          = <any 8-bit sequence of data>
    CHAR           = <any UTF-8 character (octets 0 - 127)>
    UPALPHA        = <any UTF-8 uppercase letter "A".."Z">
    LOALPHA        = <any UTF-8 lowercase letter "a".."z">
    ALPHA          = UPALPHA | LOALPHA
    DIGIT          = <any UTF-8 digit "0".."9">
    CR             = <US-ASCII CR, carriage return (13)>
    LF             = <US-ASCII LF, linefeed (10)>
    SP             = <US-ASCII SP, space (32)>
    <">            = <US-ASCII double-quote mark (34)>

`UP/1.0` defines the octet sequence `CR LF` as the end-of-line marker for all protocol 
elements except the Entity-Body.

    CRLF           = CR LF

## 3 Protocol parameters

### 3.1 UP Version

UP uses a `<major>.<minor>` numbering scheme to indicate versions of the protocol. The
protocol versioning policy is intended to allow the sender to indicate the format of a 
message and its capacity for understanding further UP communication, rather than the 
features obtained via that communication. No change is made to the version number for
the addition of message components which do not affect communication behavior or which
only add to extensible field values. The `<minor>` number is incremented when the
changes made to the protocol add features which do not change the general message 
parsing algorithm, but which may add to the message semantics and imply additional
capabilities of the sender. The `<major>` number is incremented when the format of a
message within the protocol is changed.

The version of an HTTP message is indicated by an HTTP-Version field in the first line
of the message. If the protocol version is not specified, the recipient shall not accept
the message and close the connection.

    UP-Version   = "UP" "/" 1*DIGIT "." 1*DIGIT

Note that the major and minor numbers should be treated as separate integers and that
each may be incremented higher than a single digit. Thus, `UP/2.4` is a lower version 
than `UP/2.13`, which in turn is lower than `UP/12.3`. Leading zeros should be ignored 
by recipients and never generated by senders.

This document defines the version 1.0 of the UP protocol. Applications sending 
Full-Request or Full-Response messages, as defined by this specification, must include 
an UP-Version of `UP/1.0`.

`UP/1.0` servers must:

- recognize the format of the Request-Line for `UP/1.0` requests;

- understand any valid request in the format of `UP/1.0`;

- respond appropriately with a message in the same protocol version used by the client.

`UP/1.0` clients must:

- recognize the format of the Status-Line for `UP/1.0` responses;

- understand any valid response in the format of `UP/1.0`.

### 3.2 Resource References

Resource References (RRefs) are a subset of URIs. They are a combination of alphanumeric 
characters separated by forward slashes (`/`). While URIs, as defined in the HTTP 
protocol, allow specification of fragments and query string, and allow absolute or 
relative referencing, RRefs only allow relative-to-root single resource referencing with
no option to specify fragments nor queries.

    RRef         = "/" [ path *( segment ) ]
    
    segment      = "/" path
    path         = 1*( ALPHA | DIGIT )

### 3.3 Date/Time Formats

`UP/1.0` uses ISO-8601 (RFC 3339) dates and date-times formats.

### 3.4 Media Types

`UP` uses media types in the `Body-Type` header field (some further section) in order to
provide flexible data typing. Yet, only plain text and JSON are valid as of version 1.0.

    body-type    = ( "text/plain" | "application/json" )

## 4 UP Message

## 5 Request

## 6 Response
